## 1.1 Elasticsearch介绍

Elasticsearch是一个分布式文档存储中间件,它不会将信息存储为列数据行,而是存储已序列化为JSON文档的复杂数据结构.当你在一个集群中有多个节点时,存储的文档分布在整个集群里面,并且立刻可以从任意节点去访问.

当文档被存储时,它将建立索引并且仅仅实时(1s)被搜索.Elasticsearch使用一种被称为倒排索引的数据结构,改结构支持快速全文搜索.在倒排索引里列出了所有文档中出现的每一个唯一单词并分别标识了每个单词在哪一个文档中.

索引可以被认为是文档的优化集合,每个文档索引都是字段的集合,这些字段是包含了数据的键值对.默认情况下,elasticsearch为每个字段中所有数据建立倒排索引,并且每个索引字段都有专门的优化数据结构.例如:文本字段在倒排索引里,数值和地理字段被存储在BKD数中.正是因为通过使用按字段数据结构组合,才使得Elasticsearch拥有如此快速的搜索能力.

Elasticsearch具备默认模式的能力,这意味着文档建立索引的时候无需明确指定每个字段的数据类型.当启动动态映射时,Elasticsearch自动检测并将新字段添加到索引.该默认行为使索引和浏览数据变得容易,只要文档开始建立索引,elasticsearch就会检测布尔值,浮点数和整数值,那日期和字符串,并将其映射到对应的数据类型中.

但是,最终你应该比程序鞥国家了解自己的数据结构以及如何去使用他们.你可以定义动态映射的规则,并明确的定义`mapping`去更深度的控制字段的存储和索引方式.定义你自己的`mapping`使你能够:

- 区分全文本字符串字段和精确值字符串字段
- 执行特定的语言文本分词器
- 使用自定义日期格式
- 使用无法自动检测到的数据类型,比如`geo_point`and`geo_shape`

为不同的目的以不同的方式对同一字段建立索引通常很有用。例如，您可能希望将一个字符串字段索引为全文搜索的文本字段，以及作为排序或汇总数据的关键字字段。或者，您可能选择使用多个分词器来处理包含用户输入的字符串字段的内容。

在搜索时也会使用在索引期间应用于全文字段的分析链。当您查询全文字段时，对查询文本进行相同的分析，然后再在索引中查找术语。

## 1.2 信息: 查询和分词

你可以快速使用 `Elasticsearch` 去存储文档并且能够去检索文档、元数据，是因为它的强大能力是基于 `Apache Lucene` 搜索引擎库所构建的全套搜索功能。

`Elasticsearch `提供了一个简单、连贯的 REST API 用于管理集群、索引和搜索数据。出于在测试的目的，你可以直接通过命令行或者 Kibana 中的开发者控制台中很轻松提交请求。在自己的应用程序中，你可以将 Elasticsearch 客户端用于自己选择的语言：Java, JavaScript, Go, .NET, PHP, Perl, Python or Ruby.

搜索数据:
Elasticsearch REST API 支持结构化查询、全文本查询和结合这两种查询的复杂查询。结构化查询类似于 SQL 中构造的查询类型。例如你可以在员工索引中搜索 "gender" 和 "age" 字段，然后按照 "hire_date" 字段进行排序。全文查询会查找跟查询字符串匹配的所有文档，并返回按相关性排序的文档 - 它们与你的搜索词的匹配程度如何

除了搜索单个字段外，还可以执行短语搜索，相似性搜索和前缀搜索，并返回自动匹配建议。

是否有搜索地理空间或者其他数字类型数据的需求？Elasticsearch 在优化的数据结构中索引非文本数据，这些数据结构支持高性能地理和数字查询。

你可以使用 Elasticsearch 的综合 JSON 查询语言（Query DSL）访问所有这些搜索功能，还可以构造 SQL 样式的查询，以便在 Elasticsearch 内部以本机方式搜索和聚合数据，并且 JDBC 和 ODBC 驱动允许广泛的第三方应用程序通过 SQL 与 Elasticsearch 进行交互。

分析数据：
Elasticsearch 聚合 API 使你能够构建数据的复杂摘要，并深入了解关键指标，模式和趋势。通过聚合不仅可以找到俗话说的 “大海捞针”，还可以让您回答以下问题：

大海捞针能有多少根？

针的平均长度是多少？

按制造商分类的针的中间长度是多少？

在过去的六个月中，大海捞针的数量是多少？

（PS：个人理解就是 问你是否能清楚自己的数据的详细值）

您还可以使用聚合来回答更细微的问题，例如：
您最受欢迎的针头制造商是哪些？
是否有异常或异常的针团？
由于聚合利用了用于搜索的相同数据结构，因此它们也非常快。这使您可以实时分析和可视化数据。您的报告和仪表板会随着数据的更改而更新，因此您可以根据最新信息采取措施。

重要的是，汇总通常跟搜索请求一起运行。您可以在单个请求中同时对相同数据进行文档搜索，过滤结果并执行分析。而且由于聚合是在特定搜索的上下文中计算的，因此您不仅显示了所有 70 针大小的针数，而且还显示了符合用户搜索条件的 70 针大小的针数 - 例如，所有尺寸的 70 个不粘绣针。

结尾
是否更多人想的是自动分析时间序列数据？
你可以使用机器学习功能创建数据中正常行为准确基线，并识别异常模式。使用机器学习，你可以检测到：

异常的值、计算 或者频率的时间偏差
统计
异常的行为
最棒的是你无需指定算法，模型或其他与数据科学相关的配置！



